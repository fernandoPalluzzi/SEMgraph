<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Bow-free covariance search and data de-correlation — SEMbap • SEMgraph</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Bow-free covariance search and data de-correlation — SEMbap"><meta property="og:description" content="SEMbap() function implements different deconfounding
methods to adjust the data matrix by removing latent sources of confounding
encoded in them. The selected methods are either based on: (i) Bow-free
Acyclic Paths (BAP) search, (ii) LVs proxies as additional source nodes of
the data matrix, Y or (iii) spectral transformation of Y."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SEMgraph</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/fernandoPalluzzi/SEMgraph/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bow-free covariance search and data de-correlation</h1>
    <small class="dont-index">Source: <a href="https://github.com/fernandoPalluzzi/SEMgraph/blob/HEAD/R/semLearn.R" class="external-link"><code>R/semLearn.R</code></a></small>
    <div class="hidden name"><code>SEMbap.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>SEMbap()</code> function implements different deconfounding
methods to adjust the data matrix by removing latent sources of confounding
encoded in them. The selected methods are either based on: (i) Bow-free
Acyclic Paths (BAP) search, (ii) LVs proxies as additional source nodes of
the data matrix, Y or (iii) spectral transformation of Y.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">SEMbap</span><span class="op">(</span></span>
<span>  <span class="va">graph</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dalgo <span class="op">=</span> <span class="st">"cggm"</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"BH"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  hcount <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  cmax <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-graph">graph<a class="anchor" aria-label="anchor" href="#arg-graph"></a></dt>
<dd><p>An igraph object.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A matrix whith rows corresponding to subjects, and columns to
graph nodes (variables).</p></dd>


<dt id="arg-group">group<a class="anchor" aria-label="anchor" href="#arg-group"></a></dt>
<dd><p>A binary vector. This vector must be as long as the
number of subjects. Each vector element must be 1 for cases and 0
for control subjects. If <code>NULL</code> (default), confouding within group
will not be considered.</p></dd>


<dt id="arg-dalgo">dalgo<a class="anchor" aria-label="anchor" href="#arg-dalgo"></a></dt>
<dd><p>Deconfounding method. Four algorithms are available:</p><ul><li><p>"cggm" (default). The algorithm make: (i) exhaustive search
of bow-free significant covariances (see details) through
<code><a href="Shipley.test.html">Shipley.test</a></code> function; (ii) estimation of the inverse
of the selected covariance matrix (i.e. the precision matrix, W) through
<code><a href="https://rdrr.io/pkg/ggm/man/fitConGraph.html" class="external-link">fitConGraph</a></code> function; (iii) obtain the de-correlated data
matrix, Z by multiplying the data matrix, Y rightward by the square root of
the estimated precision matrix, Z=YW^(1/2) as suggested by Grassi, Palluzzi
and Tarantino (2022).</p></li>
<li><p>"glpc". The algorithm first makes an exhaustive search of bow-free
significant covariances through <code><a href="Shipley.test.html">Shipley.test</a></code> function.
Once obtained the adjacency matrix, Graph-Laplacian PCA (gLPCA) algorithm
(Jiang et al., 2013) learns a low dimensional representation of the observed
data matrix that incorporates bow-free structure. Then, the DAG is extended
by including the confounding proxies, i.e. LVs, as additional source nodes
defined by last q principal component scores of gLPCA and these LV scores are
added to the data matrix, Z=cbind(LV,Y).</p></li>
<li><p>"pc". The procedure add additional source nodes to DAG as in "glpc"
algorithm, but confounding proxies are the q principal component scores
extracted by Spectral decomposition (SVD) selecting only graph nodes and
without graph edge information and bow-free covariance search.</p></li>
<li><p>"trim". Ćevid et al. (2020) suggest multiplying the data
matrix, Y leftward by a well selected spectrum transformation matrix, T
which modifies the singular values of Y, while keeping its singular vectors
intact, Z=TY. Trim transform limits all singular values to be at most some
costant (t), where t = median of the singuar values.</p></li>
</ul></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Multiple testing correction method. One of the values
available in <code><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></code>. By default, <code>method</code>
is set to "BH" (i.e., Benjamini-Hochberg multiple test correction).</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Significance level for false discovery rate (FDR) used
for d-separation test. This argument is used to
control data de-correlation. A higher <code>alpha</code> level includes more
hidden covariances, thus considering more sources of confounding.
If <code>alpha = 0</code>, data de-correlation is disabled. By default,
<code>alpha = 0.05</code>.</p></dd>


<dt id="arg-hcount">hcount<a class="anchor" aria-label="anchor" href="#arg-hcount"></a></dt>
<dd><p>The number of latent (or hidden) variables. By default
<code>hcount="auto"</code>, the hidden count is determined with a
permutation method (see details). Currently ignored if (dalgo ="cggm"
or "trim").</p></dd>


<dt id="arg-cmax">cmax<a class="anchor" aria-label="anchor" href="#arg-cmax"></a></dt>
<dd><p>Maximum number of parents set, C. This parameter can be
used to perform only those tests where the number of conditioning
variables does not exceed the given value. High-dimensional conditional
independence tests can be very unreliable. By default, cmax = Inf.</p></dd>


<dt id="arg-limit">limit<a class="anchor" aria-label="anchor" href="#arg-limit"></a></dt>
<dd><p>An integer value corresponding to the graph size (vcount)
tolerance. Beyond this limit, the precision matrix is estimated by
"glasso" algorithm (FHT, 2008) to reduce the computational burden of the
exaustive BAP search of the <code><a href="Shipley.test.html">Shipley.test</a></code> procedure.
By default, <code>limit = 200</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A logical value. If FALSE (default), the processed graphs
will not be plotted to screen.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Currently ignored.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A list of four objects:</p><ul><li><p>"dag", the directed acyclic graph (DAG) extracted from input graph.
If (dalgo = "glpc" or "pc"), the DAG also includes LVs as source nodes.</p></li>
<li><p>"guu", the bow-free covariance graph, BAP = dag + guu. If (dalgo =
"pc" or "trim"), guu is equal to NULL</p></li>
<li><p>"adj", the adjacency matrix of selected bow-free covariances; i.e, the
missing edges selected after multiple testing correction. If (dalgo = "pc"
or "trim"), adj matrix is equal to NULL.</p></li>
<li><p>"data", the adjusted (de-correlated) data matrix or if (dalgo = "glpc",
or "pc"), the combined data matrix, where the first columns represent LVs
scores and the other columns are the raw data.</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>Missing edges in causal network inference using a directed acyclic
graph (DAG) are frequently hidden by unmeasured confounding variables.
A Bow-free Acyclic Paths (BAP) search is performed with d-separation tests
between all pairs of variables with missing connection in the input DAG,
adding a bidirected edge (i.e., bow-free covariance) to the DAG when there
is an association between them. The d-separation test evaluates if two
variables (Y1, Y2) in a DAG are conditionally independent for a given
conditioning set, C represented in a DAG by the union of the parent sets
of Y1 and Y2 (Shipley, 2000).
A new bow-free covariance is added if there is a significant (Y1, Y2)
association at a significance level <code>alpha</code>, after multiple testing
correction. The selected covariance between pairs of nodes is interpreted
as the effect of a latent variable (LV) acting on both nodes; i.e., the LV
is an unobserved confounder. BAP-based algorithms adjust (or de-correlate)
the observed data matrix by conditioning out the latent triggers responsible
for the nuisance edges.
For "pc" algorithm the number of hidden proxies, q is determined by a permutation
method. It compares the singular values to what they would be if the variables
were independent, which is estimated by permuting the columns of the data matrix,
Y and selects components if their singular values are larger than those of the
permuted data (for a review see Dobriban, 2020).
While for "glpc" algorithm, q is determined by the number of clusters by
spectral clustering through <code><a href="https://r.igraph.org/reference/cluster_leading_eigen.html" class="external-link">cluster_leading_eigen</a></code> function.
If the input graph is not acyclic, a warning message will be raised, and a
cycle-breaking algorithm will be applied (see <code><a href="graph2dag.html">graph2dag</a></code>
for details).</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Grassi M, Palluzzi F, Tarantino B (2022). SEMgraph: An R Package for Causal Network
Analysis of High-Throughput Data with Structural Equation Models.
Bioinformatics, 38(20), 4829–4830.
&lt;https://doi.org/10.1093/bioinformatics/btac567&gt;</p>
<p>Shipley B (2000). A new inferential test for path models based on DAGs.
Structural Equation Modeling, 7(2), 206-218.
&lt;https://doi.org/10.1207/S15328007SEM0702_4&gt;</p>
<p>Jiang B, Ding C, Bin L, Tang J (2013). Graph-Laplacian PCA:
Closed-Form Solution and Robustness. IEEE Conference on Computer
Vision and Pattern Recognition, 3492-3498.
&lt;https://doi.org/10.1109/CVPR.2013.448&gt;</p>
<p>Ćevid D,  Bühlmann P, Meinshausen N (2020). Spectral deconfounding via
perturbed sparse linear models. J. Mach. Learn. Res, 21(232), 1-41.
&lt;http://jmlr.org/papers/v21/19-545.html&gt;</p>
<p>Dobriban E (2020). Permuatation methods for Factor Analysis and PCA.
Ann. Statist. 48(5): 2824-2847
&lt;https://doi.org/10.1214/19-AOS1907&gt;</p>
<p>Friedman J, Hastie T, Tibshirani R (2008). Sparse inverse covariance
estimation with the graphical lasso. Biostatistics, 9(3), 432-441.
&lt;https://doi.org/10.1093/biostatistics/kxm045&gt;</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Mario Grassi <a href="mailto:mario.grassi@unipv.it">mario.grassi@unipv.it</a></p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Set function param</span></span></span>
<span class="r-in"><span><span class="va">graph</span> <span class="op">&lt;-</span> <span class="va">sachs</span><span class="op">$</span><span class="va">graph</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">sachs</span><span class="op">$</span><span class="va">pkc</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">group</span> <span class="op">&lt;-</span><span class="va">sachs</span><span class="op">$</span><span class="va">group</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># BAP decounfounding with CGGM (default)</span></span></span>
<span class="r-in"><span><span class="va">bap</span> <span class="op">&lt;-</span> <span class="fu">SEMbap</span><span class="op">(</span><span class="va">graph</span>, <span class="va">data</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DAG conversion : TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bow-free covariances search. Use method: cggm ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of bow-free covariances / df : 4 / 37 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Max parent set(S) / Sparsity idx(s) : 5 / 18 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of clusters / number of nodes: 3 / 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-plt img"><img src="SEMbap-1.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="SEMbap-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RICF solver ended normally after 2 iterations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> deviance/df: 7.592303  srmr: 0.0426697 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># SVD decounfounding with trim method</span></span></span>
<span class="r-in"><span><span class="va">svd</span> <span class="op">&lt;-</span> <span class="fu">SEMbap</span><span class="op">(</span><span class="va">graph</span>, <span class="va">data</span>, dalgo <span class="op">=</span> <span class="st">"trim"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DAG conversion : TRUE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Estimated 4 (68%) latent confounders</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Model fitting (with node-perturbation)</span></span></span>
<span class="r-in"><span><span class="va">sem1</span> <span class="op">&lt;-</span> <span class="fu"><a href="SEMrun.html">SEMrun</a></span><span class="op">(</span><span class="va">graph</span>, <span class="va">data</span>, <span class="va">group</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NLMINB solver ended normally after 5 iterations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> deviance/df: 61.84444  srmr: 0.0701161 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Brown's combined P-value of node activation: 2.664535e-15 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Brown's combined P-value of node inhibition: 0.2368274 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">bap1</span> <span class="op">&lt;-</span> <span class="fu"><a href="SEMrun.html">SEMrun</a></span><span class="op">(</span><span class="va">bap</span><span class="op">$</span><span class="va">dag</span>, <span class="va">bap</span><span class="op">$</span><span class="va">data</span>, <span class="va">group</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NLMINB solver ended normally after 1 iterations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> deviance/df: 8.241544  srmr: 0.0366263 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Brown's combined P-value of node activation: 6.665335e-12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Brown's combined P-value of node inhibition: 5.175634e-05 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">svd1</span> <span class="op">&lt;-</span> <span class="fu"><a href="SEMrun.html">SEMrun</a></span><span class="op">(</span><span class="va">svd</span><span class="op">$</span><span class="va">dag</span>, <span class="va">svd</span><span class="op">$</span><span class="va">data</span>, <span class="va">group</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NLMINB solver ended normally after 1 iterations </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> deviance/df: 36.71868  srmr: 0.0812168 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Brown's combined P-value of node activation: 3.104739e-12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Brown's combined P-value of node inhibition: 0.2443171 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mario Grassi, Fernando Palluzzi, Barbara Tarantino.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

